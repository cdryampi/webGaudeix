{% load i18n %}

<section class="container-fluid p-0 m-0 py-5 bg-light">

  <div class="row p-0 m-0">
    <div class="col-12">
      <h3 class="h3 text-center py-5">{% blocktrans %}Descobreix els llocs icònics de Cabrera de mar{% endblocktrans %}</h3>
    </div>

    {% if user_agent.is_pc %}
      <aside class="col-lg-6 col-md-6 col-sm-12 col-12 pl-5" style="position: relative; height: 600px;">

        <div id="map-container" class="" style="height: 600px; width: 100%;"></div>
        <div id="legend-container" class="map-legend">
          <h4>{% blocktrans %}Llegenda{% endblocktrans %}</h4>
          <div class="legend-item">
            <i class="fas fa-umbrella-beach legend-icon px-1"></i>
            <span class="legend-label">{% blocktrans %}Platges{% endblocktrans %}</span>
          </div>
          <div class="legend-item">
            <i class="fas fa-info-circle legend-icon px-1"></i>
            <span class="legend-label">{% blocktrans %}Punt d'informació{% endblocktrans %}</span>
          </div>
          <div class="legend-item">
            <i class="fas fa-archway legend-icon px-1"></i>
            <span class="legend-label">{% blocktrans %}Jaciments arqueològics{% endblocktrans %}</span>
          </div>
          <div class="legend-item">
            <i class="fas fa-landmark legend-icon px-1"></i>
            <span class="legend-label">{% blocktrans %}Patrimoni cultural{% endblocktrans %}</span>
          </div>
        </div>
      </aside>
    {% endif %}

    
    <aside class="col-lg-6 col-md-6 col-sm-12 col-12 pt-md-3 pt-sm-3 pt-3 pt-0">
      <div id="accordion">
        {% regroup map_points by icono as grouped_map_points %}
        {% for group in grouped_map_points %}
        <div class="card">
          <div class="card-header bg-light" data-toggle="collapse" data-target="#collapse_{{ forloop.counter }}" aria-expanded="true" aria-controls="collapse_{{ forloop.counter }}" id="heading_{{ forloop.counter }}" style="border: 1px solid {% if group.grouper == 'platges' %}#007BFF{% elif group.grouper == 'informació' %}#17A2B8{% elif group.grouper == 'jaciments' %}#FFC107{% elif group.grouper == 'patrimoni' %}#6C757D{% else %}#000000{% endif %};">
            <h5 class="mb-0 d-flex align-items-center">
              {% if group.grouper == 'platges' %}
              <i class="fas fa-umbrella-beach legend-icon px-1"></i>
              {% elif group.grouper == 'informació' %}
              <i class="fas fa-info-circle legend-icon px-1"></i>
              {% elif group.grouper == 'jaciments' %}
              <i class="fas fa-archway legend-icon px-1"></i>
              {% elif group.grouper == 'patrimoni' %}
              <i class="fas fa-landmark legend-icon px-1"></i>
              {% else %}
              <i class="fas fa-bookmark legend-icon px-1"></i>
              {% endif %}
              <span class="btn btn-link text-white">
                <span class="mr-2 text-capitalize" style="color: {% if group.grouper == 'platges' %}#007BFF{% elif group.grouper == 'informació' %}#17A2B8{% elif group.grouper == 'jaciments' %}#FFC107{% elif group.grouper == 'patrimoni' %}#6C757D{% else %}#000000{% endif %};">{% trans group.grouper %}</span>
              </span>
              <span class="badge badge-secondary ml-auto">{{ group.list|length }}</span>
            </h5>
          </div>
          
                
    
          <div id="collapse_{{ forloop.counter }}" class="collapse" aria-labelledby="heading_{{ forloop.counter }}" data-parent="#accordion">
            <div class="card-body">
                {% for objeto in group.list  %}
                <div class="col-12">
                  <a href="{% url 'map:mapa' slug=objeto.slug %}" class="related-activity-link my-1">
                        <article class="card related-activity-card mb-3 h-100 w-100">
                            {% with imagen=objeto.postimagen %}
                            {% if imagen %}
                            <div class="image-container">
                                <picture>
                                  <source srcset="{{ imagen.imagen.small_thumbnail.url |urlencode }}" media="(max-width: 575px)">
                                  <img src="{{ imagen.imagen.large_thumbnail.url |urlencode }}"
                                      data-src="{{ imagen.imagen.large_thumbnail.url |urlencode }}"
                                      alt="{{ objeto.titulo }}"
                                      class="img-fluid lazy-load-img">
                              </picture>
                            </div>
                            {% endif %}
                            {% endwith %}
                            <div class="card-body text-center">
                                <h5 class="card-title related-activity-title">{{ objeto.titulo }}</h5>
                                <p class="card-text related-activity-description">
                                    {% if objeto.descripcion_corta|wordcount > 10 %}{{ objeto.descripcion_corta|truncatewords:10 }}...{% else %}{{ objeto.descripcion_corta }}{% endif %}
                                </p>
                                {% autoescape on %}
                                
                                {% endautoescape %}
                                <div class="related-activity-details">
                                    <p class="lead">
                                      {{ objeto.descripcion |striptags |safe |truncatewords:50 }}
                                    </p>
                                    <p class="related-activity-date-time py-3">
                                      {% if objeto.icono == 'station' %}
                                        <i class="fas fa-train" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Estació{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'restaurant' %}
                                        <i class="fas fa-utensils" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Restaurant{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'library' %}
                                        <i class="fas fa-book" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Biblioteca{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'hotel' %}
                                        <i class="fas fa-hotel" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Hotel{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'town-hall' %}
                                        <i class="fas fa-building" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Ajuntament{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'theater' %}
                                        <i class="fas fa-theater-masks" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Centre Cultural{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'sport' %}
                                        <i class="fas fa-dumbbell" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Esports{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'serveis' %}
                                        <i class="fas fa-concierge-bell" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Serveis{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'transports' %}
                                        <i class="fas fa-bus" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Transports{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'aparcaments' %}
                                        <i class="fas fa-parking" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Aparcaments{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'platges' %}
                                        <i class="fas fa-umbrella-beach" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Platges{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'informació' %}
                                        <i class="fas fa-info-circle" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Punt d'informació{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'jaciments' %}
                                        <i class="fas fa-archway" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Jaciments arqueològics{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'patrimoni' %}
                                        <i class="fas fa-landmark" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Patrimoni cultural{% endblocktrans %}</span>
                                      {% elif objeto.icono == 'flora-i-fauna' %}
                                        <i class="fas fa-tree" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Flora i fauna{% endblocktrans %}</span>
                                      {% else %}
                                        <i class="fas fa-question-circle" style="color: #3ebfab;"></i>
                                        <span class="event-icon-label">{% blocktrans %}Icono desconocido{% endblocktrans %}</span>
                                      {% endif %}
                                    </p>
                                </div>
                            </div>
                        </article>
                    </a>
                </div>
                {% endfor %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </aside>
        
  </div>
</section>
