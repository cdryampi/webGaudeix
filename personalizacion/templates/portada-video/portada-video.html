{% block extra_css %}
    <style>
        #videos-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        #video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.2s;
        }
        video{
            width: 100%;
        }
    </style>

{% endblock %}

{% block content %}
    <div id="videos-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var videosContainer = document.getElementById('videos-container');
            var videoLinks = {{ videos|safe }};
            var currentVideoIndex = 0;
            var currentVideoElement = null;
            var nextVideoElement = null;

            function cargarVideo(index) {
                if (index >= videoLinks.length) {
                    index = 0; // Vuelve al primer video cuando se haya reproducido el último
                }

                currentVideoElement = document.createElement('video');
                currentVideoElement.src = videoLinks[index];
                currentVideoElement.controls = false;
                currentVideoElement.loop = false;
                currentVideoElement.muted = true;
                currentVideoElement.playsInline = true;

                currentVideoElement.addEventListener('ended', function() {
                    currentVideoElement.classList.add('hide');
                    setTimeout(function() {
                        videosContainer.removeChild(currentVideoElement);
                        cargarVideo(index + 1);
                    }, 500); // Espera 0.5 segundos antes de cargar el siguiente video
                });

                videosContainer.appendChild(currentVideoElement);
                currentVideoElement.play();
                currentVideoElement.style.opacity = 1;

                setTimeout(function() {
                    superponerVideo(index + 1);
                }, 500); // Retrasa la superposición del siguiente video por 0.5 segundos después de cargar el video actual
            }

            function superponerVideo(index) {
                if (index >= videoLinks.length) {
                    index = 0; // Vuelve al primer video cuando se haya reproducido el último
                }

                nextVideoElement = document.createElement('video');
                nextVideoElement.src = videoLinks[index];
                nextVideoElement.controls = false;
                nextVideoElement.loop = false;
                nextVideoElement.muted = true;
                nextVideoElement.playsInline = true;
                nextVideoElement.style.opacity = 0;

                nextVideoElement.addEventListener('loadedmetadata', function() {
                    currentVideoElement.classList.add('hide');
                    setTimeout(function() {
                        videosContainer.removeChild(currentVideoElement);
                        currentVideoElement = nextVideoElement;
                        nextVideoElement = null;
                    }, 500); // Espera 0.5 segundos antes de eliminar el video actual
                });

                nextVideoElement.addEventListener('ended', function() {
                    superponerVideo(index + 1);
                });

                nextVideoElement.load();
                videosContainer.appendChild(nextVideoElement);
                nextVideoElement.play();
                nextVideoElement.style.opacity = 1;
            }

            cargarVideo(currentVideoIndex);
        });
    </script>
{% endblock %}
